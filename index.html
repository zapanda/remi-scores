<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Score Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root {
    --bg: #0e0e10;
    --surface: #18181c;
    --surface2: #222228;
    --border: #2e2e38;
    --accent: #f0c040;
    --accent2: #e05c5c;
    --text: #f0efe8;
    --muted: #7a7a8a;
    --ana: #f0c040;
    --cezi: #6ec6f5;
    --bogdan: #a78bfa;
    --mihai: #f97b6b;
    --radius: 12px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-weight: 400;
    min-height: 100vh;
    padding: 0 0 60px 0;
  }

  /* HEADER */
  header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 20px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  header h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2rem;
    letter-spacing: 3px;
    color: var(--accent);
  }

  header span {
    font-size: 0.78rem;
    color: var(--muted);
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  /* LAYOUT */
  .container {
    max-width: 860px;
    margin: 0 auto;
    padding: 32px 20px;
    display: flex;
    flex-direction: column;
    gap: 32px;
  }

  /* CARDS */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 28px 24px;
  }

  .card-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    letter-spacing: 2px;
    color: var(--accent);
    margin-bottom: 20px;
  }

  /* TOTALS */
  .totals-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  @media (min-width: 500px) {
    .totals-grid { grid-template-columns: repeat(4, 1fr); }
  }

  .total-card {
    background: var(--surface2);
    border-radius: 10px;
    padding: 16px 14px;
    text-align: center;
    border-top: 3px solid var(--border);
    transition: transform 0.15s;
  }

  .total-card:hover { transform: translateY(-2px); }
  .total-card.ana { border-top-color: var(--ana); }
  .total-card.cezi { border-top-color: var(--cezi); }
  .total-card.bogdan { border-top-color: var(--bogdan); }
  .total-card.mihai { border-top-color: var(--mihai); }

  .total-name {
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--muted);
    margin-bottom: 8px;
  }

  .total-score {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.2rem;
    letter-spacing: 1px;
  }

  .total-card.ana .total-score { color: var(--ana); }
  .total-card.cezi .total-score { color: var(--cezi); }
  .total-card.bogdan .total-score { color: var(--bogdan); }
  .total-card.mihai .total-score { color: var(--mihai); }

  /* FORM */
  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }

  @media (min-width: 500px) {
    .form-grid { grid-template-columns: repeat(4, 1fr); }
  }

  .field label {
    display: block;
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--muted);
    margin-bottom: 7px;
  }

  .field input {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 1.1rem;
    padding: 11px 13px;
    outline: none;
    transition: border-color 0.15s;
    -moz-appearance: textfield;
  }

  .field input::-webkit-outer-spin-button,
  .field input::-webkit-inner-spin-button { -webkit-appearance: none; }

  .field.ana input:focus { border-color: var(--ana); }
  .field.cezi input:focus { border-color: var(--cezi); }
  .field.bogdan input:focus { border-color: var(--bogdan); }
  .field.mihai input:focus { border-color: var(--mihai); }

  .submit-row {
    margin-top: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
  }

  button.submit {
    background: var(--accent);
    color: #0e0e10;
    border: none;
    border-radius: 8px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 2px;
    padding: 13px 32px;
    cursor: pointer;
    transition: opacity 0.15s, transform 0.1s;
  }

  button.submit:hover { opacity: 0.88; transform: translateY(-1px); }
  button.submit:active { transform: translateY(0); }
  button.submit:disabled { opacity: 0.4; cursor: not-allowed; }

  .status-msg {
    font-size: 0.85rem;
    color: var(--muted);
  }

  .status-msg.ok { color: #6fcf97; }
  .status-msg.err { color: var(--accent2); }

  /* CHART */
  .chart-wrap {
    position: relative;
    height: 320px;
  }

  /* HISTORY TABLE */
  .table-wrap {
    overflow-x: auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.88rem;
  }

  thead th {
    text-align: left;
    padding: 10px 12px;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--muted);
    border-bottom: 1px solid var(--border);
  }

  tbody tr {
    border-bottom: 1px solid var(--border);
    transition: background 0.1s;
  }

  tbody tr:last-child { border-bottom: none; }
  tbody tr:hover { background: var(--surface2); }

  tbody td {
    padding: 11px 12px;
    color: var(--text);
  }

  tbody td.pos { color: #6fcf97; }
  tbody td.neg { color: var(--accent2); }
  tbody td.zero { color: var(--muted); }

  /* LOADING */
  .loading {
    text-align: center;
    color: var(--muted);
    padding: 40px;
    font-size: 0.9rem;
    letter-spacing: 1px;
  }

  .dot-anim::after {
    content: '';
    animation: dots 1.2s infinite;
  }

  @keyframes dots {
    0%   { content: ''; }
    33%  { content: '.'; }
    66%  { content: '..'; }
    100% { content: '...'; }
  }

  /* FADE IN */
  .fade-in { animation: fadeIn 0.4s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }
</style>
</head>
<body>

<header>
  <h1>Score Tracker</h1>
  <span>Ana · Cezi · Bogdan · Mihai</span>
</header>

<div class="container">

  <!-- TOTALS -->
  <div class="card fade-in">
    <div class="card-title">Totals</div>
    <div class="totals-grid" id="totals">
      <div class="loading dot-anim">Loading</div>
    </div>
  </div>

  <!-- CHART -->
  <div class="card fade-in">
    <div class="card-title">Score Progression</div>
    <div class="chart-wrap">
      <canvas id="chart"></canvas>
    </div>
  </div>

  <!-- ADD SCORE -->
  <div class="card fade-in">
    <div class="card-title">Add Game Result</div>
    <div class="form-grid">
      <div class="field ana">
        <label>Ana</label>
        <input type="number" id="score-Ana" placeholder="0">
      </div>
      <div class="field cezi">
        <label>Cezi</label>
        <input type="number" id="score-Cezi" placeholder="0">
      </div>
      <div class="field bogdan">
        <label>Bogdan</label>
        <input type="number" id="score-Bogdan" placeholder="0">
      </div>
      <div class="field mihai">
        <label>Mihai</label>
        <input type="number" id="score-Mihai" placeholder="0">
      </div>
    </div>
    <div class="submit-row">
      <button class="submit" id="submit-btn" onclick="submitScore()">Save Game</button>
      <span class="status-msg" id="status"></span>
    </div>
  </div>

  <!-- HISTORY -->
  <div class="card fade-in">
    <div class="card-title">Game History</div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Date</th>
            <th style="color:var(--ana)">Ana</th>
            <th style="color:var(--cezi)">Cezi</th>
            <th style="color:var(--bogdan)">Bogdan</th>
            <th style="color:var(--mihai)">Mihai</th>
          </tr>
        </thead>
        <tbody id="history-body">
          <tr><td colspan="6" class="loading dot-anim">Loading</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxjWdg-CRhpW_y-Lf60AbQOR3vG5KVCjqluORpVQVUzFo4KSgmW8U0_qI0ilPZFwNDHQg/exec';
const PLAYERS = ['Ana', 'Cezi', 'Bogdan', 'Mihai'];
const COLORS = { Ana: '#f0c040', Cezi: '#6ec6f5', Bogdan: '#a78bfa', Mihai: '#f97b6b' };

let allData = [];
let chartInstance = null;

async function loadData() {
  try {
    const res = await fetch(SCRIPT_URL + '?action=getScores');
    allData = await res.json();
    renderTotals();
    renderChart();
    renderHistory();
  } catch(e) {
    document.getElementById('totals').innerHTML = '<span style="color:var(--accent2)">Failed to load data. Check your connection.</span>';
  }
}

function getTotal(player) {
  return allData.reduce((sum, row) => {
    const v = parseFloat(row[player]);
    return sum + (isNaN(v) ? 0 : v);
  }, 0);
}

function renderTotals() {
  const grid = document.getElementById('totals');
  grid.innerHTML = PLAYERS.map(p => {
    const t = getTotal(p);
    return `<div class="total-card ${p.toLowerCase()}">
      <div class="total-name">${p}</div>
      <div class="total-score">${t > 0 ? '+' : ''}${t}</div>
    </div>`;
  }).join('');
}

function renderChart() {
  // Build cumulative series, skipping rows with no date for x-axis label
  const labels = allData.map((row, i) => row['Date'] ? String(row['Date']).slice(0, 10) : `Game ${i + 1}`);

  const datasets = PLAYERS.map(p => {
    let cum = 0;
    const data = allData.map(row => {
      const v = parseFloat(row[p]);
      cum += isNaN(v) ? 0 : v;
      return cum;
    });
    return {
      label: p,
      data,
      borderColor: COLORS[p],
      backgroundColor: COLORS[p] + '18',
      borderWidth: 2.5,
      pointRadius: 4,
      pointHoverRadius: 6,
      pointBackgroundColor: COLORS[p],
      tension: 0.35,
      fill: false,
    };
  });

  const ctx = document.getElementById('chart').getContext('2d');
  if (chartInstance) chartInstance.destroy();

  chartInstance = new Chart(ctx, {
    type: 'line',
    data: { labels, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: {
          labels: {
            color: '#f0efe8',
            font: { family: 'DM Sans', size: 13 },
            boxWidth: 14,
            padding: 20,
          }
        },
        tooltip: {
          backgroundColor: '#18181c',
          borderColor: '#2e2e38',
          borderWidth: 1,
          titleColor: '#7a7a8a',
          bodyColor: '#f0efe8',
          padding: 12,
        }
      },
      scales: {
        x: {
          ticks: { color: '#7a7a8a', font: { size: 11 }, maxRotation: 45 },
          grid: { color: '#2e2e38' }
        },
        y: {
          ticks: { color: '#7a7a8a', font: { size: 11 } },
          grid: { color: '#2e2e38' }
        }
      }
    }
  });
}

function scoreClass(v) {
  if (v > 0) return 'pos';
  if (v < 0) return 'neg';
  return 'zero';
}

function renderHistory() {
  const tbody = document.getElementById('history-body');
  if (!allData.length) {
    tbody.innerHTML = '<tr><td colspan="6" style="color:var(--muted);padding:20px">No games yet.</td></tr>';
    return;
  }
  tbody.innerHTML = [...allData].reverse().map((row, i) => {
    const gameNum = allData.length - i;
    const date = row['Date'] ? String(row['Date']).slice(0, 10) : '—';
    return `<tr>
      <td style="color:var(--muted)">${gameNum}</td>
      <td>${date}</td>
      ${PLAYERS.map(p => {
        const v = parseFloat(row[p]);
        const display = isNaN(v) ? '—' : (v > 0 ? '+' + v : v);
        return `<td class="${isNaN(v) ? '' : scoreClass(v)}">${display}</td>`;
      }).join('')}
    </tr>`;
  }).join('');
}

async function submitScore() {
  const btn = document.getElementById('submit-btn');
  const status = document.getElementById('status');

  const scores = {};
  for (const p of PLAYERS) {
    const raw = document.getElementById('score-' + p).value;
    scores[p] = raw === '' ? 0 : parseFloat(raw);
  }

  const today = new Date().toISOString().slice(0, 10);

  btn.disabled = true;
  status.className = 'status-msg';
  status.textContent = 'Saving…';

  try {
    await fetch(SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify({ action: 'addScore', date: today, scores }),
      headers: { 'Content-Type': 'text/plain' }
    });

    // Clear inputs
    PLAYERS.forEach(p => document.getElementById('score-' + p).value = '');
    status.className = 'status-msg ok';
    status.textContent = '✓ Saved!';
    await loadData();
  } catch(e) {
    status.className = 'status-msg err';
    status.textContent = '✗ Save failed. Try again.';
  }

  btn.disabled = false;
  setTimeout(() => status.textContent = '', 4000);
}

loadData();
</script>
</body>
</html>
